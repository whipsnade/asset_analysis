import{a as Q,b as W,e as X,f as Y,h as Z,i as ee,j as le}from"./system-D41TC0uW.js";import{_ as te,p as ae,c as oe,b as l,w as t,r as s,g as ne,h as d,q as se,o as V,j as re,i as K,f as u,t as B,a as E,l as ue,n as de,E as y}from"./index-Bsg0fhHg.js";const ie={class:"roles-page"},ce={class:"card-header"},me={__name:"roles",setup(fe){const g=d(!1),c=d(!1),m=d(!1),p=d(!1),w=d([]),C=d([]),x=d(null),R=d(null),_=d(null),o=ne({id:null,role_name:"",role_key:"",status:1}),N={role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],role_key:[{required:!0,message:"请输入角色标识",trigger:"blur"}]},U=n=>n?new Date(n).toLocaleString("zh-CN"):"-",k=async()=>{g.value=!0;try{w.value=await Q()}finally{g.value=!1}},$=async()=>{try{C.value=await W()}catch(n){console.error(n)}},j=()=>{Object.assign(o,{id:null,role_name:"",role_key:"",status:1})},I=()=>{j(),m.value=!0},S=n=>{Object.assign(o,n),m.value=!0},T=async()=>{if(await R.value.validate().catch(()=>!1)){c.value=!0;try{o.id?(await Z(o.id,o),y.success("更新成功")):(await ee(o),y.success("创建成功")),m.value=!1,k()}finally{c.value=!1}}},q=n=>{de.confirm("确定要删除该角色吗？","提示",{type:"warning"}).then(async()=>{await Y(n.id),y.success("删除成功"),k()}).catch(()=>{})},L=async n=>{var e;x.value=n.id,p.value=!0;try{const i=await X(n.id);(e=_.value)==null||e.setCheckedKeys(i)}catch(i){console.error(i)}},A=async()=>{var v,r;const n=((v=_.value)==null?void 0:v.getCheckedKeys())||[],e=((r=_.value)==null?void 0:r.getHalfCheckedKeys())||[],i=[...n,...e];c.value=!0;try{await le(x.value,i),y.success("分配成功"),p.value=!1}finally{c.value=!1}};return ae(()=>{k(),$()}),(n,e)=>{const i=s("Plus"),v=s("el-icon"),r=s("el-button"),f=s("el-table-column"),F=s("el-tag"),O=s("el-table"),P=s("el-card"),h=s("el-input"),b=s("el-form-item"),z=s("el-switch"),H=s("el-form"),D=s("el-dialog"),G=s("el-tree"),J=se("loading");return V(),oe("div",ie,[l(P,null,{header:t(()=>[E("div",ce,[e[8]||(e[8]=E("span",null,"角色管理",-1)),l(r,{type:"primary",onClick:I},{default:t(()=>[l(v,null,{default:t(()=>[l(i)]),_:1}),e[7]||(e[7]=u(" 新增角色 ",-1))]),_:1})])]),default:t(()=>[re((V(),K(O,{data:w.value,stripe:"",border:""},{default:t(()=>[l(f,{prop:"id",label:"ID",width:"80"}),l(f,{prop:"role_name",label:"角色名称",width:"150"}),l(f,{prop:"role_key",label:"角色标识",width:"150"}),l(f,{prop:"status",label:"状态",width:"100",align:"center"},{default:t(({row:a})=>[l(F,{type:a.status===1?"success":"danger"},{default:t(()=>[u(B(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(f,{prop:"create_time",label:"创建时间","min-width":"170"},{default:t(({row:a})=>[u(B(U(a.create_time)),1)]),_:1}),l(f,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[l(r,{type:"primary",link:"",onClick:M=>S(a)},{default:t(()=>[...e[9]||(e[9]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(r,{type:"success",link:"",onClick:M=>L(a)},{default:t(()=>[...e[10]||(e[10]=[u("分配权限",-1)])]),_:1},8,["onClick"]),l(r,{type:"danger",link:"",onClick:M=>q(a),disabled:a.role_key==="admin"},{default:t(()=>[...e[11]||(e[11]=[u("删除",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[J,g.value]])]),_:1}),l(D,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value=a),title:o.id?"编辑角色":"新增角色",width:"400px"},{footer:t(()=>[l(r,{onClick:e[3]||(e[3]=a=>m.value=!1)},{default:t(()=>[...e[12]||(e[12]=[u("取消",-1)])]),_:1}),l(r,{type:"primary",loading:c.value,onClick:T},{default:t(()=>[...e[13]||(e[13]=[u("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(H,{ref_key:"formRef",ref:R,model:o,rules:N,"label-width":"80px"},{default:t(()=>[l(b,{label:"角色名称",prop:"role_name"},{default:t(()=>[l(h,{modelValue:o.role_name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.role_name=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"角色标识",prop:"role_key"},{default:t(()=>[l(h,{modelValue:o.role_key,"onUpdate:modelValue":e[1]||(e[1]=a=>o.role_key=a),disabled:!!o.id},null,8,["modelValue","disabled"])]),_:1}),o.id?(V(),K(b,{key:0,label:"状态"},{default:t(()=>[l(z,{modelValue:o.status,"onUpdate:modelValue":e[2]||(e[2]=a=>o.status=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})):ue("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(D,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=a=>p.value=a),title:"分配权限",width:"400px"},{footer:t(()=>[l(r,{onClick:e[5]||(e[5]=a=>p.value=!1)},{default:t(()=>[...e[14]||(e[14]=[u("取消",-1)])]),_:1}),l(r,{type:"primary",loading:c.value,onClick:A},{default:t(()=>[...e[15]||(e[15]=[u("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(G,{ref_key:"menuTreeRef",ref:_,data:C.value,props:{label:"title",children:"children"},"show-checkbox":"","node-key":"id","default-expand-all":""},null,8,["data"])]),_:1},8,["modelValue"])])}}},ve=te(me,[["__scopeId","data-v-3f845326"]]);export{ve as default};
