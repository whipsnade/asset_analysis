import{g as ae,a as oe,d as ne,i as re,b as se,u as pe,c as ie}from"./inventory-Cm-n6nXQ.js";import{_ as de,p as ue,c as E,b as e,w as t,r,g as U,h as y,q as ce,o as v,F as me,s as _e,i as I,f as i,a as fe,j as ge,t as j,E as b,n as ye}from"./index-BxG9Idjn.js";const be={class:"inventory-page"},we={class:"action-buttons"},ve={__name:"index",setup(Ve){const V=y(!1),k=y(!1),f=y(!1),C=y([]),S=y([]),q=y(null),c=U({keyword:"",category:""}),m=U({page:1,pageSize:20,total:0}),o=U({id:null,product_name:"",category:"",category_alias:"",spec:"",quantity:0,unit:"",sale_price:0,purchase_price:0,supplier:"",contract_remark:""}),B={product_name:[{required:!0,message:"请输入产品名称",trigger:"blur"}]},g=async()=>{V.value=!0;try{const n=await ae({page:m.page,page_size:m.pageSize,keyword:c.keyword||void 0,category:c.category||void 0});C.value=n.items,m.total=n.total}catch(n){console.error(n)}finally{V.value=!1}},h=async()=>{try{S.value=await oe()}catch(n){console.error(n)}},z=()=>{m.page=1,g()},L=()=>{c.keyword="",c.category="",z()},F=()=>{Object.assign(o,{id:null,product_name:"",category:"",category_alias:"",spec:"",quantity:0,unit:"",sale_price:0,purchase_price:0,supplier:"",contract_remark:""})},$=()=>{F(),f.value=!0},O=n=>{Object.assign(o,{...n,quantity:n.quantity??0,sale_price:n.sale_price??0,purchase_price:n.purchase_price??0}),f.value=!0},M=async()=>{if(await q.value.validate().catch(()=>!1)){k.value=!0;try{o.id?(await pe(o.id,o),b.success("更新成功")):(await ie(o),b.success("创建成功")),f.value=!1,g(),h()}catch(l){console.error(l)}finally{k.value=!1}}},N=n=>{ye.confirm("确定要删除该记录吗？","提示",{type:"warning"}).then(async()=>{try{await se(n.id),b.success("删除成功"),g()}catch(l){console.error(l)}}).catch(()=>{})},P=async n=>{try{const l=await re(n);b.success(l.message||"导入成功"),g(),h()}catch(l){console.error(l)}return!1},T=async()=>{try{const n=await ne(),l=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=window.URL.createObjectURL(l),s=document.createElement("a");s.href=p,s.download="库存导入模板.xlsx",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(p)}catch(n){b.error("下载模板失败"),console.error(n)}};return ue(()=>{g(),h()}),(n,l)=>{const p=r("el-input"),s=r("el-form-item"),A=r("el-option"),G=r("el-select"),H=r("Search"),w=r("el-icon"),_=r("el-button"),D=r("el-form"),J=r("Plus"),K=r("Download"),Q=r("Upload"),W=r("el-upload"),R=r("el-card"),d=r("el-table-column"),X=r("el-table"),Y=r("el-pagination"),u=r("el-col"),x=r("el-input-number"),Z=r("el-row"),ee=r("el-dialog"),le=ce("loading");return v(),E("div",be,[e(R,{class:"search-card"},{default:t(()=>[e(D,{inline:!0,model:c},{default:t(()=>[e(s,{label:"关键词"},{default:t(()=>[e(p,{modelValue:c.keyword,"onUpdate:modelValue":l[0]||(l[0]=a=>c.keyword=a),placeholder:"产品名称/规格",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{label:"分类"},{default:t(()=>[e(G,{modelValue:c.category,"onUpdate:modelValue":l[1]||(l[1]=a=>c.category=a),placeholder:"选择分类",clearable:"",style:{width:"150px"}},{default:t(()=>[(v(!0),E(me,null,_e(S.value,a=>(v(),I(A,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e(_,{type:"primary",onClick:z},{default:t(()=>[e(w,null,{default:t(()=>[e(H)]),_:1}),l[16]||(l[16]=i(" 搜索 ",-1))]),_:1}),e(_,{onClick:L},{default:t(()=>[...l[17]||(l[17]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),fe("div",we,[e(_,{type:"primary",onClick:$},{default:t(()=>[e(w,null,{default:t(()=>[e(J)]),_:1}),l[18]||(l[18]=i(" 新增 ",-1))]),_:1}),e(_,{onClick:T},{default:t(()=>[e(w,null,{default:t(()=>[e(K)]),_:1}),l[19]||(l[19]=i(" 下载模板 ",-1))]),_:1}),e(W,{ref:"uploadRef","show-file-list":!1,"before-upload":P,accept:".xlsx,.xls"},{default:t(()=>[e(_,{type:"success"},{default:t(()=>[e(w,null,{default:t(()=>[e(Q)]),_:1}),l[20]||(l[20]=i(" 导入Excel ",-1))]),_:1})]),_:1},512)])]),_:1}),e(R,{class:"table-card"},{default:t(()=>[ge((v(),I(X,{data:C.value,stripe:"",border:""},{default:t(()=>[e(d,{prop:"product_name",label:"产品名称","min-width":"150","show-overflow-tooltip":""}),e(d,{prop:"category",label:"设备分类",width:"120","show-overflow-tooltip":""}),e(d,{prop:"category_alias",label:"分类别名",width:"100","show-overflow-tooltip":""}),e(d,{prop:"spec",label:"型号规格","min-width":"180","show-overflow-tooltip":""}),e(d,{prop:"quantity",label:"数量",width:"80",align:"center"}),e(d,{prop:"unit",label:"单位",width:"60",align:"center"}),e(d,{prop:"sale_price",label:"销售单价",width:"100",align:"right"},{default:t(({row:a})=>[i(j(a.sale_price?`¥${a.sale_price}`:"-"),1)]),_:1}),e(d,{prop:"purchase_price",label:"采购单价",width:"100",align:"right"},{default:t(({row:a})=>[i(j(a.purchase_price?`¥${a.purchase_price}`:"-"),1)]),_:1}),e(d,{prop:"supplier",label:"供应商",width:"100","show-overflow-tooltip":""}),e(d,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[e(_,{type:"primary",link:"",onClick:te=>O(a)},{default:t(()=>[...l[21]||(l[21]=[i("编辑",-1)])]),_:1},8,["onClick"]),e(_,{type:"danger",link:"",onClick:te=>N(a)},{default:t(()=>[...l[22]||(l[22]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,V.value]]),e(Y,{"current-page":m.page,"onUpdate:currentPage":l[2]||(l[2]=a=>m.page=a),"page-size":m.pageSize,"onUpdate:pageSize":l[3]||(l[3]=a=>m.pageSize=a),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onChange:g,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),e(ee,{modelValue:f.value,"onUpdate:modelValue":l[15]||(l[15]=a=>f.value=a),title:o.id?"编辑库存":"新增库存",width:"600px"},{footer:t(()=>[e(_,{onClick:l[14]||(l[14]=a=>f.value=!1)},{default:t(()=>[...l[23]||(l[23]=[i("取消",-1)])]),_:1}),e(_,{type:"primary",loading:k.value,onClick:M},{default:t(()=>[...l[24]||(l[24]=[i("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(D,{ref_key:"formRef",ref:q,model:o,rules:B,"label-width":"100px"},{default:t(()=>[e(Z,{gutter:20},{default:t(()=>[e(u,{span:24},{default:t(()=>[e(s,{label:"产品名称",prop:"product_name"},{default:t(()=>[e(p,{modelValue:o.product_name,"onUpdate:modelValue":l[4]||(l[4]=a=>o.product_name=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:t(()=>[e(s,{label:"设备分类",prop:"category"},{default:t(()=>[e(p,{modelValue:o.category,"onUpdate:modelValue":l[5]||(l[5]=a=>o.category=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:t(()=>[e(s,{label:"分类别名",prop:"category_alias"},{default:t(()=>[e(p,{modelValue:o.category_alias,"onUpdate:modelValue":l[6]||(l[6]=a=>o.category_alias=a),placeholder:"如：综合布线、监控系统"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:t(()=>[e(s,{label:"供应商",prop:"supplier"},{default:t(()=>[e(p,{modelValue:o.supplier,"onUpdate:modelValue":l[7]||(l[7]=a=>o.supplier=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:24},{default:t(()=>[e(s,{label:"型号规格",prop:"spec"},{default:t(()=>[e(p,{modelValue:o.spec,"onUpdate:modelValue":l[8]||(l[8]=a=>o.spec=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:8},{default:t(()=>[e(s,{label:"数量",prop:"quantity"},{default:t(()=>[e(x,{modelValue:o.quantity,"onUpdate:modelValue":l[9]||(l[9]=a=>o.quantity=a),min:0,precision:2,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:4},{default:t(()=>[e(s,{label:"单位",prop:"unit"},{default:t(()=>[e(p,{modelValue:o.unit,"onUpdate:modelValue":l[10]||(l[10]=a=>o.unit=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:t(()=>[e(s,{label:"销售单价",prop:"sale_price"},{default:t(()=>[e(x,{modelValue:o.sale_price,"onUpdate:modelValue":l[11]||(l[11]=a=>o.sale_price=a),min:0,precision:2,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:t(()=>[e(s,{label:"采购单价",prop:"purchase_price"},{default:t(()=>[e(x,{modelValue:o.purchase_price,"onUpdate:modelValue":l[12]||(l[12]=a=>o.purchase_price=a),min:0,precision:2,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:24},{default:t(()=>[e(s,{label:"合同备注",prop:"contract_remark"},{default:t(()=>[e(p,{modelValue:o.contract_remark,"onUpdate:modelValue":l[13]||(l[13]=a=>o.contract_remark=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},xe=de(ve,[["__scopeId","data-v-abb93153"]]);export{xe as default};
