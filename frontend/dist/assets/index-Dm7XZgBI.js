import{g as le,a as te,i as ae,d as oe,u as ne,c as re}from"./inventory-DnOSjXM6.js";import{_ as se,p as pe,c as E,b as e,w as t,r as n,g as U,h as y,q as ie,o as b,F as ue,s as de,i as B,f as u,a as ce,j as me,t as F,E as v,n as _e}from"./index-XRkGQpRf.js";const fe={class:"inventory-page"},ge={class:"action-buttons"},ye={__name:"index",setup(be){const V=y(!1),w=y(!1),f=y(!1),C=y([]),S=y([]),q=y(null),d=U({keyword:"",category:""}),c=U({page:1,pageSize:20,total:0}),o=U({id:null,product_name:"",category:"",category_alias:"",spec:"",quantity:0,unit:"",sale_price:0,purchase_price:0,supplier:"",contract_remark:""}),$={product_name:[{required:!0,message:"请输入产品名称",trigger:"blur"}]},g=async()=>{V.value=!0;try{const r=await le({page:c.page,page_size:c.pageSize,keyword:d.keyword||void 0,category:d.category||void 0});C.value=r.items,c.total=r.total}catch(r){console.error(r)}finally{V.value=!1}},k=async()=>{try{S.value=await te()}catch(r){console.error(r)}},z=()=>{c.page=1,g()},j=()=>{d.keyword="",d.category="",z()},R=()=>{Object.assign(o,{id:null,product_name:"",category:"",category_alias:"",spec:"",quantity:0,unit:"",sale_price:0,purchase_price:0,supplier:"",contract_remark:""})},M=()=>{R(),f.value=!0},N=r=>{Object.assign(o,{...r,quantity:r.quantity??0,sale_price:r.sale_price??0,purchase_price:r.purchase_price??0}),f.value=!0},P=async()=>{if(await q.value.validate().catch(()=>!1)){w.value=!0;try{o.id?(await ne(o.id,o),v.success("更新成功")):(await re(o),v.success("创建成功")),f.value=!1,g(),k()}catch(l){console.error(l)}finally{w.value=!1}}},L=r=>{_e.confirm("确定要删除该记录吗？","提示",{type:"warning"}).then(async()=>{try{await oe(r.id),v.success("删除成功"),g()}catch(l){console.error(l)}}).catch(()=>{})},O=async r=>{try{const l=await ae(r);v.success(l.message||"导入成功"),g(),k()}catch(l){console.error(l)}return!1};return pe(()=>{g(),k()}),(r,l)=>{const m=n("el-input"),s=n("el-form-item"),A=n("el-option"),T=n("el-select"),G=n("Search"),x=n("el-icon"),_=n("el-button"),I=n("el-form"),H=n("Plus"),J=n("Upload"),K=n("el-upload"),D=n("el-card"),p=n("el-table-column"),Q=n("el-table"),W=n("el-pagination"),i=n("el-col"),h=n("el-input-number"),X=n("el-row"),Y=n("el-dialog"),Z=ie("loading");return b(),E("div",fe,[e(D,{class:"search-card"},{default:t(()=>[e(I,{inline:!0,model:d},{default:t(()=>[e(s,{label:"关键词"},{default:t(()=>[e(m,{modelValue:d.keyword,"onUpdate:modelValue":l[0]||(l[0]=a=>d.keyword=a),placeholder:"产品名称/规格",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{label:"分类"},{default:t(()=>[e(T,{modelValue:d.category,"onUpdate:modelValue":l[1]||(l[1]=a=>d.category=a),placeholder:"选择分类",clearable:"",style:{width:"150px"}},{default:t(()=>[(b(!0),E(ue,null,de(S.value,a=>(b(),B(A,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e(_,{type:"primary",onClick:z},{default:t(()=>[e(x,null,{default:t(()=>[e(G)]),_:1}),l[16]||(l[16]=u(" 搜索 ",-1))]),_:1}),e(_,{onClick:j},{default:t(()=>[...l[17]||(l[17]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),ce("div",ge,[e(_,{type:"primary",onClick:M},{default:t(()=>[e(x,null,{default:t(()=>[e(H)]),_:1}),l[18]||(l[18]=u(" 新增 ",-1))]),_:1}),e(K,{ref:"uploadRef","show-file-list":!1,"before-upload":O,accept:".xlsx,.xls"},{default:t(()=>[e(_,{type:"success"},{default:t(()=>[e(x,null,{default:t(()=>[e(J)]),_:1}),l[19]||(l[19]=u(" 导入Excel ",-1))]),_:1})]),_:1},512)])]),_:1}),e(D,{class:"table-card"},{default:t(()=>[me((b(),B(Q,{data:C.value,stripe:"",border:""},{default:t(()=>[e(p,{prop:"product_name",label:"产品名称","min-width":"150","show-overflow-tooltip":""}),e(p,{prop:"category",label:"设备分类",width:"120","show-overflow-tooltip":""}),e(p,{prop:"category_alias",label:"分类别名",width:"100","show-overflow-tooltip":""}),e(p,{prop:"spec",label:"型号规格","min-width":"180","show-overflow-tooltip":""}),e(p,{prop:"quantity",label:"数量",width:"80",align:"center"}),e(p,{prop:"unit",label:"单位",width:"60",align:"center"}),e(p,{prop:"sale_price",label:"销售单价",width:"100",align:"right"},{default:t(({row:a})=>[u(F(a.sale_price?`¥${a.sale_price}`:"-"),1)]),_:1}),e(p,{prop:"purchase_price",label:"采购单价",width:"100",align:"right"},{default:t(({row:a})=>[u(F(a.purchase_price?`¥${a.purchase_price}`:"-"),1)]),_:1}),e(p,{prop:"supplier",label:"供应商",width:"100","show-overflow-tooltip":""}),e(p,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[e(_,{type:"primary",link:"",onClick:ee=>N(a)},{default:t(()=>[...l[20]||(l[20]=[u("编辑",-1)])]),_:1},8,["onClick"]),e(_,{type:"danger",link:"",onClick:ee=>L(a)},{default:t(()=>[...l[21]||(l[21]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,V.value]]),e(W,{"current-page":c.page,"onUpdate:currentPage":l[2]||(l[2]=a=>c.page=a),"page-size":c.pageSize,"onUpdate:pageSize":l[3]||(l[3]=a=>c.pageSize=a),total:c.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onChange:g,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),e(Y,{modelValue:f.value,"onUpdate:modelValue":l[15]||(l[15]=a=>f.value=a),title:o.id?"编辑库存":"新增库存",width:"600px"},{footer:t(()=>[e(_,{onClick:l[14]||(l[14]=a=>f.value=!1)},{default:t(()=>[...l[22]||(l[22]=[u("取消",-1)])]),_:1}),e(_,{type:"primary",loading:w.value,onClick:P},{default:t(()=>[...l[23]||(l[23]=[u("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(I,{ref_key:"formRef",ref:q,model:o,rules:$,"label-width":"100px"},{default:t(()=>[e(X,{gutter:20},{default:t(()=>[e(i,{span:24},{default:t(()=>[e(s,{label:"产品名称",prop:"product_name"},{default:t(()=>[e(m,{modelValue:o.product_name,"onUpdate:modelValue":l[4]||(l[4]=a=>o.product_name=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:t(()=>[e(s,{label:"设备分类",prop:"category"},{default:t(()=>[e(m,{modelValue:o.category,"onUpdate:modelValue":l[5]||(l[5]=a=>o.category=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:t(()=>[e(s,{label:"分类别名",prop:"category_alias"},{default:t(()=>[e(m,{modelValue:o.category_alias,"onUpdate:modelValue":l[6]||(l[6]=a=>o.category_alias=a),placeholder:"如：综合布线、监控系统"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:t(()=>[e(s,{label:"供应商",prop:"supplier"},{default:t(()=>[e(m,{modelValue:o.supplier,"onUpdate:modelValue":l[7]||(l[7]=a=>o.supplier=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:24},{default:t(()=>[e(s,{label:"型号规格",prop:"spec"},{default:t(()=>[e(m,{modelValue:o.spec,"onUpdate:modelValue":l[8]||(l[8]=a=>o.spec=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:8},{default:t(()=>[e(s,{label:"数量",prop:"quantity"},{default:t(()=>[e(h,{modelValue:o.quantity,"onUpdate:modelValue":l[9]||(l[9]=a=>o.quantity=a),min:0,precision:2,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:4},{default:t(()=>[e(s,{label:"单位",prop:"unit"},{default:t(()=>[e(m,{modelValue:o.unit,"onUpdate:modelValue":l[10]||(l[10]=a=>o.unit=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:t(()=>[e(s,{label:"销售单价",prop:"sale_price"},{default:t(()=>[e(h,{modelValue:o.sale_price,"onUpdate:modelValue":l[11]||(l[11]=a=>o.sale_price=a),min:0,precision:2,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:t(()=>[e(s,{label:"采购单价",prop:"purchase_price"},{default:t(()=>[e(h,{modelValue:o.purchase_price,"onUpdate:modelValue":l[12]||(l[12]=a=>o.purchase_price=a),min:0,precision:2,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:24},{default:t(()=>[e(s,{label:"合同备注",prop:"contract_remark"},{default:t(()=>[e(m,{modelValue:o.contract_remark,"onUpdate:modelValue":l[13]||(l[13]=a=>o.contract_remark=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},we=se(ye,[["__scopeId","data-v-7a9282aa"]]);export{we as default};
